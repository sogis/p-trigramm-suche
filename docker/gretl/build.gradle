import ch.so.agi.gretl.tasks.*
import ch.so.agi.gretl.api.TransferSet

defaultTasks 'createIdx'

def db_uri_data = 'jdbc:postgresql://data-db/data'
def db_uri_search = 'jdbc:postgresql://search-db/search'
def db_user = 'ddluser'
def db_pass = 'ddluser'

task createTbl(type: SqlExecutor){
    database = [db_uri_search, db_user, db_pass]
    sqlFiles = ['schema/layer_tbl.sql']
}

task loadTbl(type: Db2Db, dependsOn: createTbl){ 
    sourceDb = [db_uri_data, db_user, db_pass]
    targetDb = [db_uri_search, db_user, db_pass]
    transferSets = [
        new TransferSet('data/adr_features.sql', 'public.features', false),
        new TransferSet('data/layer.sql', 'public.layer', true)
    ];
}

task createIdx(type: SqlExecutor, dependsOn: loadTbl){
    database = [db_uri_search, db_user, db_pass]
    sqlFiles = ['schema/layer_idx.sql', 'schema/features_idx.sql']
}